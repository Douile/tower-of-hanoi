'use strict';/*
tower_of_hanoi.js
Created by Douile (https://github.com/Douile/)
For licensing see LICENSE (MIT)
*/function map(a,b,c,d,e){return(a-b)/(c-b)*(e-d)+d}function Stack(a){var b=new Uint8Array(a);return Object.defineProperties(b,{position:{value:0,writable:!0},add:{value:function value(a){if(this.position>=this.byteLength)throw new Error("Stack already full");return this[this.position]=a,this.position+=1}},remove:{value:function(){if(1>this.position)throw new Error("Stack empty");this.position-=1;var a=this[this.position];return a}},peek:{value:function value(){return 0<this.position?this[this.position-1]:null}}}),b}function Modal(a,b){var c=document.querySelector("#".concat(a));if(null===c)throw new Error("Could not find modal ".concat(a));b||(b={});var d=c.innerHTML,e=/\$[^\$\n]+\$/g,f=d.match(e);if(null!==f){var g=!0,h=!1,i=void 0;try{for(var j,k=f[Symbol.iterator]();!(g=(j=k.next()).done);g=!0){var l=j.value,m=l.substr(1,l.length-2);d=d.replace(l,m in b?b[m]:"")}}catch(a){h=!0,i=a}finally{try{g||null==k.return||k.return()}finally{if(h)throw i}}}var n=document.createElement("template");n.innerHTML=d;var o=document.importNode(n.content,!0);return document.querySelector(".container-modal").appendChild(o),o}function App(){var a=Math.floor,b={};return Object.defineProperties(b,{_canvas:{enumerable:!1,writable:!0},canvas:{enumerable:!1,get:function get(){return this._canvas?this._canvas:this._canvas=document.getElementById("game-canvas")}},_context:{enumerable:!1,writable:!0},context:{enumerable:!1,get:function get(){return this._context?this._context:this._context=this.canvas.getContext("2d")}},width:{get:function get(){return this.canvas.width},set:function set(a){return this.canvas.width=a}},height:{get:function get(){return this.canvas.height},set:function set(a){return this.canvas.height=a}},_selected:{enumerable:!1,writable:!0,value:0},selected:{get:function get(){return this._selected},set:function set(a){if(null!==this.floating)this._selected=0>a?this.nTowers-1:a>=this.nTowers?0:a;else if(a<this._selected){for(var b=a;0<=b;b-=1)if(0<this.towers[b].position)return this._selected=b;for(var c=this.nTowers-1;c>a;c-=1)if(0<this.towers[c].position)return this._selected=c}else if(a>this._selected){for(var d=a;d<this.nTowers;d++)if(0<this.towers[d].position)return this._selected=d;for(var e=0;e<a;e++)if(0<this.towers[e].position)return this._selected=e}}},_nTowers:{enumerable:!1,writable:!0},nTowers:{get:function get(){return this._nTowers},set:function set(a){1<a&&(this._nTowers=a,this.buildTowers())}},_nRings:{enumerable:!1,writable:!0},nRings:{get:function get(){return this._nRings},set:function set(a){1<a&&(this._nRings=a,this.buildTowers())}},_acceptInput:{value:!0,writable:!0,enumerable:!1},buildTowers:{value:function value(){var a=Math.pow;if(!isNaN(this.nRings)&&!isNaN(this.nTowers)){this.floating=null,this.minMoves=3===this.nTowers?a(2,this.nRings)-1:null,this.moves=0,this.playKey=0,delete this.towers,this.towers=Array(this.nTowers);for(var b,c=0;c<this.nTowers;c++){if(b=Stack(this.nRings),0==c)for(var d=1;d<=this.nRings;d++)b.add(this.nRings-d);this.towers[c]=b}this.selected=0}}},initialize:{value:function value(a,b){console.log("App starting"),this.width=a,this.height=b,this.floating=null,this.nTowers=3,this.nRings=3,console.log(this.sizes(this.nTowers,this.nRings));var c=this;return window.addEventListener("keydown",function(a){c.onKey(a)}),this.context.font="10px consolas",this.draw(),document.querySelector(".container-loading").style.opacity=0,this}},onKey:{value:function value(a){if(this._acceptInput)switch(a.keyCode){case 39:case 68:this.selected+=1;break;case 37:case 65:this.selected-=1;break;case 13:case 32:case 38:case 40:case 87:case 83:if(null!==this.floating){var b=this.towers[this.selected];(0===b.position||0<b.position&&b[b.position-1]>this.floating)&&(b.add(this.floating),this.floating=null,this.moves+=1)}else this.floating=this.towers[this.selected].remove();// console.log(`Completed ${this.towers[this.nTowers-1].position}/${this.nRings}`);
if(this.towers[this.nTowers-1].position===this.nRings){// alert('Well done!');
// this.nRings += 1;
var c=document.querySelector(".container-game");c.removeAttribute("completed"),requestAnimationFrame(function(){c.setAttribute("completed","")})}break;case 82:this.buildTowers();}}},sizes:{value:function value(b,c){var d=Math.max,e=Math.ceil;if(isNaN(b))throw new Error("nTowers must be a number");if(isNaN(c))throw new Error("nRings must be a number");for(var f=this.width,g=this.height,h=1-2*.2,j=f*h,k=g*h,l=j/b,m=l*.1,n=(l-m)/2,o=k*.9,p=Array(b),q=0;q<b;q++){var r=l*q+n+(f-j)/2;p[q]={x:r,y:(k-o)/2+(g-k)/2}}for(var s=Array(c),t=o/d(20,e(1.4*this.nRings)),u=0;u<c;u++){var v=a(map(u,0,c,.3*l,.9*l));s[u]={width:v,height:t,offsetX:n-(l-v)/2}}return{tower:{width:m,height:o,positions:p},rings:s}}},draw:{value:function value(){if(this)var c=this;window.requestAnimationFrame(function(){c.draw()});this.context.clearRect(0,0,this.width,this.height);for(var d,e=b.sizes(this.nTowers,this.nRings),f=0;f<this.nTowers;f++){d=e.tower.positions[f],this.context.fillStyle="#ffffff",this.context.fillRect(d.x,d.y,e.tower.width,e.tower.height);for(var o=0;o<this.towers[f].position;o++){var g=this.towers[f][o],h=d.x-e.rings[g].offsetX,k=d.y+e.tower.height-1.4*e.rings[g].height*(o+1);this.context.fillStyle="#".concat(a(map(g,0,this.nRings-1,0,255)).toString(16).padStart(2,"0"),"ff00"),this.context.fillRect(h,k,e.rings[g].width,e.rings[g].height),this.selected===f&&null===this.floating&&o==this.towers[f].position-1&&(this.context.strokeStyle="#ff0000",this.context.lineWidth="4",this.context.strokeRect(h,k,e.rings[g].width,e.rings[g].height))}if(this.selected===f&&null!==this.floating){var l=e.rings[this.floating],m=d.x-l.offsetX,n=d.y-1.4*l.height;this.context.fillStyle="#00ff00",this.context.fillRect(m,n,l.width,l.height)}}this.context.fillStyle="#ffffff",this.context.textAlign="right",this.context.font="80pt consolas",this.context.fillText("".concat(this.moves,"/").concat(this.minMoves),this.width,100)}},generateMoves:{value:function value(a,b,c,d,e){0<a&&(this.generateMoves(a-1,b,d,c,e),e.push(b),e.push(c),this.generateMoves(a-1,d,c,b,e))}},play:{value:function value(){function a(){d.playKey===e&&c<b.length&&!1===d._acceptInput?(d.towers[b[c+1]].add(d.towers[b[c]].remove()),d._selected=b[c+1],c+=2,d.moves+=1,setTimeout(a,100)):(d._acceptInput=!0,document.querySelector(".overlay-auto").setAttribute("paused",""))}document.querySelector(".container-loading").style.opacity=1,this._acceptInput=!1,this.buildTowers();var b=[];this.generateMoves(this.nRings,0,2,1,b),document.querySelector(".container-loading").style.opacity=0;var c=0,d=this,e=new Date().getTime();d.playKey=e,a()}},stop:{value:function value(){this._acceptInput=!0}}}),b}var _app=App().initialize(4e3,4e3);window.addEventListener("click",function(a){var b=0;a.target.classList.forEach(function(c){switch(c){case"overlay-settings":console.log("Toggling settings overlay");break;case"overlay-auto":var d=a.target.hasAttribute("paused");d?(_app.play(),a.target.removeAttribute("paused")):(_app.stop(),a.target.setAttribute("paused",""));break;case"overlay-plus":_app.nRings+=1;break;case"overlay-minus":3<_app.nRings&&(_app.nRings-=1);break;case"modal-background":document.querySelector(".container-modal").innerHTML="";break;case"overlay-github":break;default:b+=1;}}),b===a.target.classList.length&&a.preventDefault()});
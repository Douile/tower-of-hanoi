'use strict';/*
tower_of_hanoi.js
Created by Douile (https://github.com/Douile/)
For licensing see LICENSE (MIT)
*/function map(a,b,c,d,e){return(a-b)/(c-b)*(e-d)+d}function Stack(a){var b=new Uint8Array(a);return Object.defineProperties(b,{position:{value:0,writable:!0},add:{value:function value(a){if(this.position>=this.byteLength)throw new Error("Stack already full");return this[this.position]=a,this.position+=1}},remove:{value:function(){if(1>this.position)throw new Error("Stack empty");this.position-=1;var a=this[this.position];return a}}}),b}function App(){var a=Math.floor,b={};return Object.defineProperties(b,{_canvas:{enumerable:!1,writable:!0},canvas:{enumerable:!1,get:function get(){return this._canvas?this._canvas:this._canvas=document.getElementById("game-canvas")}},_context:{enumerable:!1,writable:!0},context:{enumerable:!1,get:function get(){return this._context?this._context:this._context=this.canvas.getContext("2d")}},width:{get:function get(){return this.canvas.width},set:function set(a){return this.canvas.width=a}},height:{get:function get(){return this.canvas.height},set:function set(a){return this.canvas.height=a}},_selected:{enumerable:!1,writable:!0,value:0},selected:{get:function get(){return this._selected},set:function set(a){if(null!==this.floating)this._selected=0>a?this.nTowers-1:a>=this.nTowers?0:a;else if(a<this._selected){for(var b=a;0<=b;b-=1)if(0<this.towers[b].position)return this._selected=b;for(var c=this.nTowers-1;c>a;c-=1)if(0<this.towers[c].position)return this._selected=c}else if(a>this._selected){for(var d=a;d<this.nTowers;d++)if(0<this.towers[d].position)return this._selected=d;for(var e=0;e<a;e++)if(0<this.towers[e].position)return this._selected=e}}},_nTowers:{enumerable:!1,writable:!0},nTowers:{get:function get(){return this._nTowers},set:function set(a){1<a&&(this._nTowers=a,this.buildTowers())}},_nRings:{enumerable:!1,writable:!0},nRings:{get:function get(){return this._nRings},set:function set(a){1<a&&(this._nRings=a,this.buildTowers())}},buildTowers:{value:function value(){if(!isNaN(this.nRings)&&!isNaN(this.nTowers)){delete this.towers,this.towers=Array(this.nTowers);for(var a,b=0;b<this.nTowers;b++){if(a=Stack(this.nRings),0==b)for(var c=1;c<=this.nRings;c++)a.add(this.nRings-c);this.towers[b]=a}this.selected=0}}},initialize:{value:function value(a,b){console.log("App starting"),this.width=a,this.height=b,this.floating=null,this.nTowers=3,this.nRings=3,console.log(this.sizes(this.nTowers,this.nRings));var c=this;return window.addEventListener("keydown",function(a){c.onKey(a)}),this.context.font="10px consolas",this.draw(),document.querySelector(".container-loading").style.opacity=0,this}},onKey:{value:function value(a){switch(a.keyCode){case 39:case 68:this.selected+=1;break;case 37:case 65:this.selected-=1;break;case 13:case 32:case 38:case 40:case 87:case 83:if(null!==this.floating){var b=this.towers[this.selected];(0===b.position||0<b.position&&b[b.position-1]>this.floating)&&(b.add(this.floating),this.floating=null)}else this.floating=this.towers[this.selected].remove();// console.log(`Completed ${this.towers[this.nTowers-1].position}/${this.nRings}`);
this.towers[this.nTowers-1].position===this.nRings&&(alert("Well done!"),this.nRings+=1);}}},sizes:{value:function value(b,c){var d=Math.max,e=Math.ceil;if(isNaN(b))throw new Error("nTowers must be a number");if(isNaN(c))throw new Error("nRings must be a number");for(var f=this.width,g=this.height,h=1-2*.2,j=f*h,k=g*h,l=j/b,m=l*.1,n=(l-m)/2,o=k*.9,p=Array(b),q=0;q<b;q++){var r=l*q+n+(f-j)/2;p[q]={x:r,y:(k-o)/2+(g-k)/2}}for(var s=Array(c),t=o/d(20,e(1.4*this.nRings)),u=0;u<c;u++){var v=a(map(u,0,c,.3*l,.9*l));s[u]={width:v,height:t,offsetX:n-(l-v)/2}}return{tower:{width:m,height:o,positions:p},rings:s}}},draw:{value:function value(){if(this)var c=this;window.requestAnimationFrame(function(){c.draw()});this.context.clearRect(0,0,this.width,this.height);for(var d,e=b.sizes(this.nTowers,this.nRings),f=0;f<this.nTowers;f++){d=e.tower.positions[f],this.context.fillStyle="#ffffff",this.context.fillRect(d.x,d.y,e.tower.width,e.tower.height);for(var o=0;o<this.towers[f].position;o++){var g=this.towers[f][o],h=d.x-e.rings[g].offsetX,k=d.y+e.tower.height-1.4*e.rings[g].height*(o+1);this.context.fillStyle="#".concat(a(map(g,0,this.nRings-1,0,255)).toString(16).padStart(2,"0"),"ff00"),this.context.fillRect(h,k,e.rings[g].width,e.rings[g].height),this.selected===f&&null===this.floating&&o==this.towers[f].position-1&&(this.context.strokeStyle="#ff0000",this.context.lineWidth="1.5",this.context.strokeRect(h,k,e.rings[g].width,e.rings[g].height))}if(this.selected===f&&null!==this.floating){var l=e.rings[this.floating],m=d.x-l.offsetX,n=d.y-1.4*l.height;this.context.fillStyle="#00ff00",this.context.fillRect(m,n,l.width,l.height)}}this.context.fillStyle="#ffffff"}}}),b}var _app=App().initialize(1e3,500);document.querySelector(".overlay-settings").addEventListener("click",function(){console.log("Click")});